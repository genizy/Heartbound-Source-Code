<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-10001</depth>
  <persistent>-1</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.shadow_surface = surface_create(room_width, room_height);
surface_set_target(global.shadow_surface);
draw_clear_alpha(c_black, 0);
surface_reset_target();
shadow_level = 0.8;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="5">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (surface_exists(global.shadow_surface))
    surface_free(global.shadow_surface);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (surface_exists(global.shadow_surface))
{
    surface_set_target(global.shadow_surface);
    draw_clear_alpha(c_black, 0);
    draw_set_color(c_black);
    draw_set_alpha(shadow_level);
    draw_rectangle(0, 0, room_width, room_height, false);
    draw_set_alpha(1);
    range_left_3 = (x - 300) + random_range(-1, 1);
    range_right_3 = x + 300 + random_range(-1, 1);
    range_top_3 = (y - 150) + random_range(-1, 1);
    range_bottom_3 = y + 150 + random_range(-1, 1);
    draw_set_blend_mode(bm_subtract);
    draw_ellipse_color(range_left_3, range_top_3, range_right_3, range_bottom_3, c_black, c_black, 0);
    draw_set_alpha(shadow_level * 0.75);
    draw_set_blend_mode(bm_normal);
    draw_ellipse_color(range_left_3, range_top_3, range_right_3, range_bottom_3, image_blend, image_blend, 0);
    draw_set_alpha(1);
    range_left_2 = (x - 270) + random_range(-1, 1);
    range_right_2 = x + 270 + random_range(-1, 1);
    range_top_2 = (y - 120) + random_range(-1, 1);
    range_bottom_2 = y + 120 + random_range(-1, 1);
    draw_set_blend_mode(bm_subtract);
    draw_ellipse_color(range_left_2, range_top_2, range_right_2, range_bottom_2, c_black, c_black, 0);
    draw_set_alpha(shadow_level * 0.5);
    draw_set_blend_mode(bm_normal);
    draw_ellipse_color(range_left_2, range_top_2, range_right_2, range_bottom_2, image_blend, image_blend, 0);
    draw_set_alpha(1);
    range_left_1 = (x - 240) + random_range(-1, 1);
    range_right_1 = x + 240 + random_range(-1, 1);
    range_top_1 = (y - 90) + random_range(-1, 1);
    range_bottom_1 = y + 90 + random_range(-1, 1);
    draw_set_blend_mode(bm_subtract);
    draw_ellipse_color(range_left_1, range_top_1, range_right_1, range_bottom_1, c_black, c_black, 0);
    draw_set_alpha(shadow_level * 0.25);
    draw_set_blend_mode(bm_normal);
    draw_ellipse_color(range_left_1, range_top_1, range_right_1, range_bottom_1, image_blend, image_blend, 0);
    draw_set_alpha(1);
    
    if (instance_exists(obj_blocker_parent))
    {
        with (obj_blocker_parent)
        {
            if (shadow_active == 1)
            {
                if (shadow_mask != 0)
                    mask_index = shadow_mask;
                
                var range_left = obj_light_spot.x - 100;
                var range_right = obj_light_spot.x + 100;
                var range_top = obj_light_spot.y - 50;
                var range_bottom = obj_light_spot.y + 50;
                
                if (collision_ellipse(range_left, range_top, range_right, range_bottom, id, 1, 0))
                {
                    light_x = obj_light_spot.x;
                    light_y = obj_light_spot.y + ((obj_light_spot.y - obj_light_spot.y) / 2);
                    
                    while (trace1 == 1)
                    {
                        direct1 = point_direction(light_x, light_y, x, y) + direct1Mod;
                        point1X = light_x + lengthdir_x(light_radius, direct1);
                        point1Y = light_y + lengthdir_y(light_radius, direct1);
                        direct1Mod += 0.1;
                        
                        if (!collision_line(light_x, light_y, point1X, point1Y, id, true, false))
                            trace1 = 0;
                    }
                    
                    while (trace1 == 0 &amp;&amp; trace3 == 1)
                    {
                        point3X = light_x + lengthdir_x(mover1, direct1 - 0.1);
                        point3Y = light_y + lengthdir_y(mover1, direct1 - 0.1);
                        mover1 += 0.5;
                        
                        if (collision_circle(point3X, point3Y, 1, id, 1, 0))
                            trace3 = 0;
                        
                        if (mover1 &gt; light_radius)
                            trace3 = 0;
                    }
                    
                    while (trace2 == 1)
                    {
                        direct2 = point_direction(light_x, light_y, x, y) + direct2Mod;
                        point2X = light_x + lengthdir_x(light_radius, direct2);
                        point2Y = light_y + lengthdir_y(light_radius, direct2);
                        direct2Mod -= 0.1;
                        
                        if (!collision_line(light_x, light_y, point2X, point2Y, id, true, false))
                            trace2 = 0;
                    }
                    
                    while (trace2 == 0 &amp;&amp; trace4 == 1)
                    {
                        point4X = light_x + lengthdir_x(mover2, direct2 + 0.1);
                        point4Y = light_y + lengthdir_y(mover2, direct2 + 0.1);
                        mover2 += 0.5;
                        
                        if (collision_circle(point4X, point4Y, 1, id, 1, 0))
                            trace4 = 0;
                        
                        if (mover2 &gt; light_radius)
                            trace4 = 0;
                    }
                    
                    draw1X = point1X + random_range(-1, 1);
                    draw2X = point2X + random_range(-1, 1);
                    draw3X = point3X;
                    draw4X = point4X;
                    draw1Y = point1Y + random_range(-1, 1);
                    draw2Y = point2Y + random_range(-1, 1);
                    draw3Y = point3Y;
                    draw4Y = point4Y;
                    draw_set_blend_mode(bm_subtract);
                    draw_triangle_color(draw1X, draw1Y, draw2X, draw2Y, draw3X, draw3Y, 0, 0, 0, 0);
                    draw_triangle_color(draw2X, draw2Y, draw3X, draw3Y, draw4X, draw4Y, 0, 0, 0, 0);
                    draw_set_blend_mode(bm_normal);
                    draw_set_alpha(obj_light_spot.shadow_level);
                    draw_triangle_color(draw1X, draw1Y, draw2X, draw2Y, draw3X, draw3Y, 0, 0, 0, 0);
                    draw_triangle_color(draw2X, draw2Y, draw3X, draw3Y, draw4X, draw4Y, 0, 0, 0, 0);
                    draw_set_alpha(1);
                    draw_set_blend_mode(bm_subtract);
                    draw_sprite_ext(sprite_index, image_index, round(x), round(y), image_xscale, image_yscale, image_angle, c_black, 1);
                    draw_set_blend_mode(bm_normal);
                    draw_sprite_ext(sprite_index, image_index, round(x), round(y), image_xscale, image_yscale, image_angle, image_blend, obj_light_spot.shadow_level);
                }
                else if (distance_to_object(obj_player_parent) &lt;= 150)
                {
                    draw_set_blend_mode(bm_subtract);
                    draw_sprite_ext(sprite_index, image_index, round(x), round(y), image_xscale, image_yscale, image_angle, c_black, 1);
                    draw_set_blend_mode(bm_normal);
                    draw_sprite_ext(sprite_index, image_index, round(x), round(y), image_xscale, image_yscale, image_angle, image_blend, obj_light_spot.shadow_level);
                }
                
                if (light_x_old != light_x || light_y_old != light_y)
                {
                    trace1 = 1;
                    trace2 = 1;
                    trace3 = 1;
                    trace4 = 1;
                    mover1 = 0;
                    mover2 = 0;
                    direct1Mod = 0;
                    direct2Mod = 0;
                    light_x_old = light_x;
                    light_y_old = light_y;
                }
                
                if (shadow_mask != 0)
                    mask_index = sprite_index;
            }
        }
    }
    
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_surface(global.shadow_surface, 0, 0);
}
else
{
    global.shadow_surface = surface_create(room_width, room_height);
    surface_set_target(global.shadow_surface);
    draw_clear_alpha(c_black, 0);
    surface_reset_target();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.1</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.1</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.1</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.2</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints />
</object>
